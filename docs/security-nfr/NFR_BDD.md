# Сценарии приемки требований безопасности

## Study Notes Security Requirements

### Feature: Безопасное хранение паролей
  Scenario: Пароли хранятся в хэшированном виде
    Given система аутентификации настроена
    When пользователь регистрируется с паролем "MySecret123"
    Then пароль должен быть захеширован с помощью Argon2id
    And исходный пароль не должен храниться в базе данных

  Scenario: Защита от перебора паролей
    Given пользователь существует в системе
    When происходит 6 попыток входа с неверным паролем за 1 минуту
    Then система должна заблокировать IP на 15 минут
    And должна быть записана запись в лог безопасности

### Feature: Защита персональных данных
  Scenario: Шифрование заметок в базе данных
    Given пользователь создает заметку с конфиденциальной информацией
    When заметка сохраняется в базу данных
    Then содержимое заметки должно быть зашифровано с использованием AES-256
    And ключ шифрования должен храниться отдельно от данных

  Scenario: Доступ только владельца к заметкам
    Given два пользователя: UserA и UserB
    When UserB пытается получить заметки UserA
    Then система должна вернуть ошибку 403 Forbidden
    And UserB должен видеть только пустой список или свои заметки

### Feature: Валидация и обработка ошибок
  Scenario: Защита от SQL-инъекций
    Given API endpoint для поиска заметок
    When пользователь отправляет запрос с SQL-инъекцией в параметрах
    Then система должна обработать запрос без выполнения инъекции
    And должен вернуться корректный ответ или ошибка валидации

  Scenario: Безопасные сообщения об ошибках
    When происходит внутренняя ошибка сервера
    Then ответ не должен содержать детали stack trace
    And должен возвращаться стандартизированный формат ошибки
    And в логах должна сохраняться полная информация для разработчиков

### Feature: Мониторинг безопасности
  Scenario: Логирование событий аутентификации
    When пользователь успешно входит в систему
    Then событие должно быть записано в лог безопасности
    And запись должна содержать timestamp, user_id, IP-адрес

  Scenario: Обнаружение подозрительной активности
    When происходит 10 неудачных попыток входа с одного IP за 5 минут
    Then система должна отправить оповещение администратору
    And IP должен быть добавлен в watchlist для мониторинга
