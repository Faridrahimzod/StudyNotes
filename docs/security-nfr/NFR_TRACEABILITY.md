# Матрица трассировки требований безопасности

| NFR ID | Story/Task | Приоритет | Release/Milestone |
|--------|------------|-----------|-------------------|
| NFR-01 | SEC-001: Реализация шифрования заметок в БД | High | Release 1.1 |
| NFR-02 | AUTH-001: Внедрение Argon2id для хеширования паролей | High | Release 1.0 |
| NFR-03 | AUTH-002: Реализация rate limiting для авторизации | High | Release 1.0 |
| NFR-04 | API-001: Настройка валидации Pydantic для всех endpoint'ов | High | Release 1.0 |
| NFR-05 | INFRA-001: Настройка HTTPS/TLS в production | Medium | Release 1.1 |
| NFR-06 | API-002: Стандартизация формата ошибок RFC7807 | Medium | Release 1.0 |
| NFR-07 | MON-001: Внедрение системы логирования security событий | Medium | Release 1.1 |
| NFR-08 | CI-001: Интеграция security scanning в CI/CD | High | Release 1.0 |
| NFR-09 | INFRA-002: Настройка автоматического резервного копирования | Medium | Release 1.2 |
| NFR-10 | API-003: Добавление лимитов на размер запросов и данных | Low | Release 1.1 |

## Описание задач

### SEC-001: Реализация шифрования заметок в БД
- Шифрование полей title и body в таблице notes
- Генерация и безопасное хранение ключей шифрования
- Тесты на корректность шифрования/дешифрования

### AUTH-001: Внедрение Argon2id для хеширования паролей
- Интеграция библиотеки argon2-cffi
- Настройка параметров: time=3, memory=64MB, parallelism=1
- Миграция существующих паролей (если есть)

### AUTH-002: Реализация rate limiting для авторизации
- Ограничение 5 попыток входа в минуту с одного IP
- Блокировка IP при превышении лимита на 15 минут
- Логирование подозрительной активности

### API-001: Настройка валидации Pydantic для всех endpoint'ов
- Создание схем для всех входных данных
- Валидация типов, диапазонов, форматов
- Защита от SQL-инъекций и XSS

### INFRA-001: Настройка HTTPS/TLS в production
- Получение SSL сертификата
- Конфигурация reverse proxy (nginx)
- Редирект с HTTP на HTTPS

### API-002: Стандартизация формата ошибок RFC7807
- Единый формат ответов об ошибках
- Маскирование sensitive information
- Добавление correlation_id для трассировки

### MON-001: Внедрение системы логирования security событий
- Логирование успешных/неуспешных входов
- Аудит операций с данными
- Интеграция с системой мониторинга

### CI-001: Интеграция security scanning в CI/CD
- Настройка SAST (Static Application Security Testing)
- Сканирование зависимостей на уязвимости
- Интеграция с GitHub Security

### INFRA-002: Настройка автоматического резервного копирования
- Ежедневные бэкапы базы данных
- Хранение бэкапов в защищенном месте
- Тестирование процедуры восстановления

### API-003: Добавление лимитов на размер запросов и данных
- Ограничение размера тела запроса (10MB)
- Лимит на количество заметок пользователя (100)
- Защита от DoS атак
