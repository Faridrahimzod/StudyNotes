# ADR-002: Standardized Error Handling with RFC 7807

Дата: 2024-09-28
Статус: Accepted

## Context
При обработке ошибок в Study Notes API ранее использовались нестандартизированные форматы ответов, что приводило к:
- Раскрытию внутренней информации системы в ошибках
- Сложностям в клиентской обработке ошибок
- Отсутствию корреляции запросов при дебаггинге
- Потенциальным утечкам чувствительной информации

## Decision
Внедрить стандартизированную обработку ошибок по спецификации RFC 7807:

1. **Единый формат ошибок** для всех endpoint'ов:
   ```json
   {
     "type": "about:blank",
     "title": "Название ошибки",
     "status": 400,
     "detail": "Детальное описание",
     "correlation_id": "uuid-v4"
   }
2. Маскирование деталей в production среде

3. Correlation ID для трассировки запросов

4. Категоризация ошибок по типам:

- validation_error - ошибки валидации
- auth_error - ошибки аутентификации
- not_found - ресурс не найден
- server_error - внутренние ошибки сервера

## Consequences
### Положительные
- Стандартизированный API для клиентов
- Улучшенная безопасность (нет утечки внутренней информации)
- Упрощение дебаггинга через correlation_id
- Соответствие лучшим практикам REST API

### Отрицательные
- Дополнительная сложность в обработке ошибок
- Необходимость обучения команды новому формату
- Увеличение размера ответов с ошибками

## Security Impact
- Снижает риски: R10 (небезопасные сообщения об ошибках)
- Реализует NFR: NFR-06 (безопасные сообщения об ошибках)
- Защищает от угроз: STRIDE - I (Information Disclosure)

## Links
- NFR-06 (Безопасные сообщения об ошибках)
- STRIDE: F1 - Information Disclosure
- Risks: R10
- Tests: tests/test_errors.py
- Implementation: app/main.py (глобальные обработчики ошибок)
