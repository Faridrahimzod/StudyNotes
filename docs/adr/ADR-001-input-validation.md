# ADR-001: Strict Input Validation for Study Notes API

Дата: 2024-09-28
Статус: Partially Implemented

## Context
Study Notes API обрабатывает пользовательские данные, включая заметки, теги и метаданные. Без строгой валидации входных данных система уязвима для различных атак, включая:
- SQL-инъекции
- XSS (межсайтовый скриптинг)
- Overflow атаки через большие payloads
- Path traversal атаки

Требуется гарантировать целостность и безопасность данных на всех уровнях приложения.

## Decision
Применять многоуровневую валидацию входных данных:

1. **Pydantic схемы** для всех входных endpoint'ов
2. **Ограничение размеров** полей (макс 200 символов для заголовка, 10KB для тела заметки)
3. **Санитизация HTML** для предотвращения XSS
4. **Валидация типов** и форматов данных
5. **Ограничение количества** тегов на заметку (макс 10)

Конкретные лимиты:
- `title`: 1-200 символов
- `body`: 1-10000 символов
- `tags`: массив 0-10 элементов, каждый 1-50 символов

## Consequences
### Положительные
- Защита от распространенных веб-уязвимостей
- Улучшение качества данных
- Стандартизация API контрактов
- Лучшая обработка ошибок

### Отрицательные
- Увеличение сложности валидации
- Необходимость обработки ошибок валидации
- Возможные false-positive при строгих ограничениях

## Security Impact
- **Снижает риски**: R4 (SQL-инъекции), R12 (несанкционированный доступ)
- **Реализует NFR**: NFR-04 (валидация входных данных)
- **Защищает от угроз**: STRIDE - T (Tampering), I (Information Disclosure)

## Links
- NFR-04 (Валидация входных данных)
- STRIDE: F1, F4 - Tampering, Information Disclosure
- Risks: R4, R12
- Tests: `tests/test_validation.py`
- Implementation: `app/schemas/note.py`, `app/routes/notes.py`
